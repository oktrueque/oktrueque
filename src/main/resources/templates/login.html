<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head lang="en">
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <meta http-equiv="x-ua-compatible" content="ie=edge"/>
    <title>OkTrueque</title>

    <link href="../../static/common/img/favicon/favicon.96x96.png" th:href="@{/common/img/favicon/favicon-96x96.png}"
          rel="apple-touch-icon" type="image/png" sizes="96x96"/>
    <link href="../../static/common/img/favicon/favicon.32x32.png" th:href="@{/common/img/favicon/favicon-32x32.png}"
          rel="apple-touch-icon" type="image/png" sizes="32x32"/>
    <link href="../../static/common/img/favicon/favicon.16x16.png" th:href="@{/common/img/favicon/favicon-16x16.png}"
          rel="apple-touch-icon" type="image/png" sizes="16x16"/>
    <link href="../../static/common/img/favicon/favicon.32x32.png" th:href="@{/common/img/favicon/favicon-32x32.png}"
          rel="icon" type="image/png"/>
    <link href="favicon.ico" rel="shortcut icon"/>

    <!-- HTML5 shim and Respond.js for < IE9 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Vendors Styles -->
    <!-- v1.0.0 -->
    <link rel="stylesheet" type="text/css" href="../assets/vendors/bootstrap/dist/css/bootstrap.min.css"
          th:href="@{/vendors/bootstrap/dist/css/bootstrap.min.css}"/>

    <!-- Clean UI Styles -->
    <link rel="stylesheet" type="text/css" href="../assets/common/css/source/custom/login.css"
          th:href="@{/common/css/source/custom/login.css}"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="../assets/common/css/source/main.css"
          th:href="@{/common/css/source/main.css}"/>

    <!-- Vendors Scripts -->
    <!-- v1.0.0 -->
    <script src="../assets/vendors/jquery/jquery.min.js" th:src="@{/vendors/jquery/jquery.min.js}"></script>
    <script src="../assets/vendors/tether/dist/js/tether.min.js"
            th:src="@{/vendors/tether/dist/js/tether.min.js}"></script>
    <script src="../assets/vendors/bootstrap/dist/js/bootstrap.min.js"
            th:src="@{/vendors/bootstrap/dist/js/bootstrap.min.js}"></script>
    <script src="../assets/vendors/html5-form-validation/dist/jquery.validation.min.js"
            th:src="@{/vendors/html5-form-validation/dist/jquery.validation.min.js}"></script>
    <script src="../assets/vendors/bootstrap-show-password/bootstrap-show-password.min.js"
            th:src="@{/vendors/bootstrap-show-password/bootstrap-show-password.min.js}"></script>
</head>
<body class="theme-default single-page single-page-inverse">

<section class="page-content">

    <div class="page-content-inner background-img">

        <!-- Login Omega Page -->
        <div class="single-page-block-header">
            <div class="row">
                <div class="col-lg-4">
                    <div class="logo">
                        <a href="javascript: history.back();">
                            <img src="../static/common/img/simbolo.png" th:src="@{common/img/simbolo.png}"
                                 alt="Clean UI Admin Template"/>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="single-page-block">
            <div class="single-page-block-inner effect-3d-element"
                 style="transform-origin: center 50% 0px; transform: matrix3d(0.999909, 0, 0.0134874, -1.34874e-05, -0.00175247, 0.991523, 0.129922, -0.000129922, -0.0133731, -0.129934, 0.991433, -0.000991433, 0, 0, 0, 1);">
                <div class="blur-placeholder" th:src="@{/common/img/4.jpg}"><!-- --></div>
                <div class="single-page-block-form">
                    <h3 class="text-center">
                        <i class="icmn-enter margin-right-10"></i>
                        Login
                    </h3>
                    <div th:if="${loginError}">
                        <p class="text-danger"><b>Usuario o contraseña incorrectos. Vuelva a intentar</b></p>
                        <hr/>
                    </div>
                    <form name='f' action="login" method='POST'>
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <div class="form-group">
                            <input id="validation-email" class="form-control" placeholder="Email or Username"
                                   name="username" type="text" required="true"/>
                            <!--data-validation="[EMAIL]"-->
                        </div>

                        <div class="form-group">

                            <input id="validation-password" class="form-control password" name="password"
                                   type="password" data-validation="[L>=6]"
                                   data-validation-message="$ must be at least 6 characters" placeholder="Password"
                                   required="true"/>

                        </div>
                        <div class="form-group">
                            <a id="resetPassLink"  class="pull-right">Recuperar contraseña</a>

                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="example6" checked=""/>
                                    Recordarme
                                </label>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary width-150">Iniciar Sesión</button>
                           <a style="float: right" href="/register" class="btn btn-primary width-150">Registrarse</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="single-page-block-footer text-center">
            <ul class="list-unstyled list-inline">
                <li><a href="javascript: void(0);">Terminos y Condiciones</a></li>
                <li><a href="javascript: void(0);">Contacto</a></li>
            </ul>
        </div>
        <!-- End Login Omega Page -->

    </div>

    <!--MODAL PASSWORD RESET SENT-->
    <div class="modal fade" id="modalPasswordReset" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true" style="display: none; overflow-y: scroll;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h4 class="modal-title">Aviso</h4>
                </div>
                <div class="modal-body">
                    <span>Revisa tu correo electronico, tu password se ha restablecido.</span>
                </div>
                <div class="row modal-footer">
                    <button type="button" data-dismiss="modal" class="btn btn-primary">Aceptar</button>
                </div>
            </div>
        </div>
    </div>
    <!--END MODAL PASSWORD RESET SENT-->


    <!-- Page Scripts -->
    <script>
        $(function () {
            // Show/Hide Password
            $('.password').password({
                eyeClass: '',
                eyeOpenClass: 'icmn-eye',
                eyeCloseClass: 'icmn-eye-blocked'
            });
            // Set Background Image for Form Block
            function setImage() {
                var imgUrl = $('.page-content-inner').css('background-image');
                $('.blur-placeholder').css('background-image', imgUrl);
            };
            function changeImgPositon() {
                var width = $(window).width(),
                    height = $(window).height(),
                    left = -(width - $('.single-page-block-inner').outerWidth()) / 2,
                    top = -(height - $('.single-page-block-inner').outerHeight()) / 2;
                $('.blur-placeholder').css({
                    width: width,
                    height: height,
                    left: left,
                    top: top
                });
            };
            setImage();
            changeImgPositon();
            $(window).on('resize', function () {
                changeImgPositon();
            });
            // Mouse Move 3d Effect
            var rotation = function (e) {
                var perX = (e.clientX / $(window).width()) - 0.5;
                var perY = (e.clientY / $(window).height()) - 0.5;
                TweenMax.to(".effect-3d-element", 0.4, {
                    rotationY: 15 * perX,
                    rotationX: 15 * perY,
                    ease: Linear.easeNone,
                    transformPerspective: 1000,
                    transformOrigin: "center"
                })
            };
        });
    </script>
    <script th:inline="javascript">
        /*<![CDATA[*/

        var token = [[${_csrf.token}]];
        var header = [[${_csrf.headerName}]];

        document.addEventListener("DOMContentLoaded", function () {

            let emailInput = $("#validation-email");
            $("#resetPassLink").on("click", function () {
                if(emailInput.val().length!==0){
                    $.ajax({
                        type: "POST",
                        url: "/resetPassword",
                        contentType : "application/json",
                        data: emailInput.val(),
                        dataType : 'text',
                        beforeSend: function (xhr) {
                            xhr.setRequestHeader(header, token);
                        },
                        success: function () {
                            console.log("Ajax sent");
                            $("#modalPasswordReset").modal('show');
                        },
                        error: function (e) {
                            console.log(JSON.stringify(e));
                            console.log("input: "+emailInput.val());
                        }
                    });
                } else {
                    document.getElementById('validation-email').placeholder = 'Inserta mail o username para recuperar la contraseña';
                }
            });

        });
        /*]]>*/
    </script>
    <!-- End Page Scripts -->


    <div class="main-backdrop"><!-- --></div>

</section>

</body>
</html>
